version: 1
type: model
name: test_model
label: "Test commerce data"
connection: "connection_name"

explores:
  - name: order_lines_all
    from: order_lines
    description: "Description for order lines"
    label: "Description for order lines"
    group_label: "Purchases"
    fields: [ALL_FIELDS*, -orders.test_removal*, -discounts.country]
    join_for_analysis: [all_orders, customers]

    joins:
      - name: all_orders
        from: orders
        type: left_outer
        relationship: many_to_one
        sql_on: "${order_lines_all.order_id}=${all_orders.order_id}"

      - name: country_detail
        type: left_outer
        relationship: many_to_one
        sql_on: "${discounts.country}=${country_detail.country_id}"

      - name: customers
        from: customers
        foreign_key: customer_id

      - name: discounts
        type: left_outer
        relationship: one_to_many
        sql_on: "${all_orders.order_id}=${discounts.order_id}"

      - name: discount_detail
        type: left_outer
        relationship: one_to_one
        sql_on: "${discounts.discount_id}=${discount_detail.discount_id} AND ${discounts.order_week} is not null"

  - name: discounts_only
    view_name: discounts
