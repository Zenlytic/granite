version: 1
type: model
name: test_model
label: "Test commerce data"
connection: "connection_name"

explores:
  - name: order_lines
    description: "Description for order lines"
    label: "Description for order lines"
    group_label: "Purchases"
    fields: [ALL_FIELDS*, -orders.sub_channel]
    join_for_analysis: [orders, customers]

    joins:
      - name: orders
        type: left_outer
        relationship: many_to_one
        sql_on: "${order_lines.order_id}=${orders.order_id}"

      - name: country_detail
        type: left_outer
        relationship: many_to_one
        sql_on: "${discounts.country}=${country_detail.country_id}"

      - name: customers
        type: left_outer
        relationship: many_to_one
        from: customers
        foreign_key: customer_id

      - name: discounts
        type: left_outer
        relationship: one_to_many
        sql_on: "${orders.order_id}=${discounts.order_id}"

      - name: discount_detail
        type: left_outer
        relationship: one_to_one
        sql_on: "${discounts.discount_id}=${discount_detail.discount_id}"

  - name: discounts_only
    view_name: discounts
